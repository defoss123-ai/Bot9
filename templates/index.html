<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MEXC Flipping Bot</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <h1 class="h3 mb-3">Флиппинг-бот MEXC</h1>

  <ul class="nav nav-tabs" id="tabs" role="tablist">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#api">API</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#pairs">Пары</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#strategy">Стратегия</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#stats">Статистика</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#logs">Логи</button></li>
  </ul>

  <div class="tab-content border border-top-0 p-3 bg-white">
    <div class="tab-pane fade show active" id="api">
      <div class="row g-2">
        <div class="col-md-5"><input id="apiKey" class="form-control" placeholder="API Key"></div>
        <div class="col-md-5"><input id="apiSecret" class="form-control" placeholder="API Secret"></div>
        <div class="col-md-2 d-grid"><button class="btn btn-primary" onclick="saveKeys()">Сохранить</button></div>
      </div>
      <div class="mt-2 d-grid d-md-inline"><button class="btn btn-outline-secondary" onclick="testConnection()">Проверить подключение</button></div>
      <div id="apiMsg" class="small mt-2 text-muted"></div>
    </div>

    <div class="tab-pane fade" id="pairs">
      <div class="d-flex justify-content-between mb-2">
        <h2 class="h6 m-0">Торговые пары</h2>
        <button class="btn btn-sm btn-success" data-bs-toggle="modal" data-bs-target="#pairModal">Добавить пару</button>
      </div>
      <table class="table table-sm table-striped">
        <thead><tr><th>Символ</th><th>Плечо</th><th>TP%</th><th>SL%</th><th>Автоотмена</th><th>Статус</th><th>Действия</th></tr></thead>
        <tbody id="pairsBody"></tbody>
      </table>
    </div>

    <div class="tab-pane fade" id="strategy">
      <div class="row g-2">
        <div class="col-md-4"><label class="form-label">Lookback</label><input class="form-control" value="20"></div>
        <div class="col-md-4"><label class="form-label">Volume multiplier</label><input class="form-control" value="1.5"></div>
        <div class="col-md-4"><label class="form-label">Интервал (сек)</label><input class="form-control" value="60"></div>
      </div>
      <button class="btn btn-primary mt-3">Сохранить</button>
    </div>

    <div class="tab-pane fade" id="stats">
      <div class="mb-2">Статус: <span id="statusText">—</span></div>
      <table class="table table-sm"><thead><tr><th>ID</th><th>Символ</th><th>Сторона</th><th>Действия</th></tr></thead><tbody id="positionsBody"></tbody></table>
    </div>

    <div class="tab-pane fade" id="logs">
      <div id="logsBox" class="border rounded p-2" style="height:260px; overflow:auto; font-family:monospace;"></div>
    </div>
  </div>
</div>

<div class="modal fade" id="pairModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Добавить пару</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body">
      <input class="form-control mb-2" placeholder="Символ (например BTCUSDT)">
      <input class="form-control mb-2" placeholder="Плечо" value="10">
      <input class="form-control mb-2" placeholder="TP%" value="2.0">
      <input class="form-control mb-2" placeholder="SL%" value="1.0">
      <input class="form-control" placeholder="Автоотмена (сек)" value="60">
    </div>
    <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button><button class="btn btn-primary">Сохранить</button></div>
  </div></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
async function saveKeys() {
  document.getElementById('apiMsg').textContent = 'Эндпоинт /api/keys будет добавлен в следующей итерации.';
}
async function testConnection() {
  document.getElementById('apiMsg').textContent = 'Эндпоинт /api/test_connection будет добавлен в следующей итерации.';
}
async function refreshPairs() {
  const res = await fetch('/api/pairs');
  const data = await res.json();
  const body = document.getElementById('pairsBody');
  body.innerHTML = Object.entries(data).map(([symbol, s]) =>
    `<tr><td>${symbol}</td><td>${s.leverage}</td><td>${s.tp_percent}</td><td>${s.sl_percent}</td><td>${s.cancel_time}</td><td>${s.enabled ? 'Вкл' : 'Выкл'}</td><td><button class='btn btn-sm btn-outline-danger'>Удалить</button></td></tr>`
  ).join('');
}
async function refreshStatus() {
  const res = await fetch('/api/status');
  const data = await res.json();
  document.getElementById('statusText').textContent = `running=${data.running}, active_pairs=${data.active_pairs}, trader_ready=${data.trader_ready}`;
}
async function refreshLogs() {
  const res = await fetch('/api/logs');
  const logs = await res.json();
  document.getElementById('logsBox').innerHTML = logs.map(l => `${l.timestamp} | ${l.level} | ${l.message}`).join('<br>');
}
async function refreshAll() {
  await Promise.all([refreshPairs(), refreshStatus(), refreshLogs()]);
}
refreshAll();
setInterval(refreshAll, 5000);
</script>
</body>
</html>
